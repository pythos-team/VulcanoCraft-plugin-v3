<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Plugin Repository</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="floating-bg">
        <div class="floating-element el-1"></div>
        <div class="floating-element el-2"></div>
        <div class="floating-element el-3"></div>
        <div class="floating-element el-4"></div>
        <div class="floating-element el-5"></div>
    </div>

    <div class="d-flex align-items-center justify-content-center" style="min-height: 100vh;">
        <div class="col-md-5 col-lg-4">
            <div class="card shadow-lg border-0" style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);">
                <div class="card-body text-center p-5">
                    <div class="mb-4">
                        <img src="../../images/plugin-repo-icon.png" class="mb-3" style="width: 80px; height: 80px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));" alt="Login">
                        <h2 class="fw-bold text-primary mb-3">Welkom!</h2>
                        <p class="text-muted mb-4">Log in of maak een account aan</p>
                    </div>
                    
                    <!-- Login Form -->
                    <div id="loginForm">
                        <h4 class="mb-3">Inloggen</h4>
                        <div class="mb-3">
                            <input type="text" class="form-control form-control-lg" id="loginUsername" placeholder="Gebruikersnaam">
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control form-control-lg" id="loginPassword" placeholder="Wachtwoord">
                        </div>
                        <div id="loginError" class="alert alert-danger" style="display: none;"></div>
                        <button type="button" class="btn btn-primary btn-lg w-100 mb-3" id="loginBtn">
                            <i class="fas fa-sign-in-alt me-2"></i>Inloggen
                        </button>
                        <p class="text-muted">
                            Nog geen account? <a href="#" id="showRegister">Registreren</a><br>
                            <a href="#" id="showChangePassword">Wachtwoord wijzigen</a>
                        </p>
                    </div>

                    <!-- Register Form -->
                    <div id="registerForm" style="display: none;">
                        <h4 class="mb-3">Account Aanmaken</h4>
                        <div class="mb-3">
                            <input type="text" class="form-control form-control-lg" id="registerUsername" placeholder="Gebruikersnaam">
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control form-control-lg" id="registerPassword" placeholder="Wachtwoord">
                        </div>
                        <div id="registerError" class="alert alert-danger" style="display: none;"></div>
                        <button type="button" class="btn btn-primary btn-lg w-100 mb-3" id="registerBtn">
                            <i class="fas fa-user-plus me-2"></i>Account Aanmaken
                        </button>
                        <p class="text-muted">
                            Al een account? <a href="#" id="showLogin">Inloggen</a><br>
                            <a href="#" id="showChangePasswordFromRegister">Wachtwoord wijzigen</a>
                        </p>
                    </div>

                    <!-- Change Password Form -->
                    <div id="changePasswordForm" style="display: none;">
                        <h4 class="mb-3">Wachtwoord Wijzigen</h4>
                        <div class="mb-3">
                            <input type="text" class="form-control form-control-lg" id="changeUsername" placeholder="Gebruikersnaam">
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control form-control-lg" id="oldPassword" placeholder="Huidig wachtwoord">
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control form-control-lg" id="newPassword" placeholder="Nieuw wachtwoord">
                        </div>
                        <div id="changePasswordError" class="alert alert-danger" style="display: none;"></div>
                        <button type="button" class="btn btn-primary btn-lg w-100 mb-3" id="changePasswordBtn">
                            <i class="fas fa-key me-2"></i>Wachtwoord Wijzigen
                        </button>
                        <p class="text-muted">
                            <a href="#" id="showLoginFromChange">Terug naar inloggen</a>
                        </p>
                    </div>

                    <div class="mt-4 pt-3 border-top">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            Veilig en priv√©
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navigation between forms
        document.getElementById('showRegister').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Check if registration is enabled
            fetch('/registration-status')
                .then(response => response.json())
                .then(data => {
                    if (data.enabled) {
                        document.getElementById('loginForm').style.display = 'none';
                        document.getElementById('registerForm').style.display = 'block';
                        document.getElementById('changePasswordForm').style.display = 'none';
                    } else {
                        showRegistrationDisabledMessage();
                    }
                })
                .catch(() => {
                    showRegistrationDisabledMessage();
                });
        });
        
        document.getElementById('showLogin').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('changePasswordForm').style.display = 'none';
        });
        
        document.getElementById('showChangePassword').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('changePasswordForm').style.display = 'block';
        });
        
        document.getElementById('showChangePasswordFromRegister').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('changePasswordForm').style.display = 'block';
        });
        
        document.getElementById('showLoginFromChange').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('changePasswordForm').style.display = 'none';
        });

        // Login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = '/';
                } else {
                    document.getElementById('loginError').textContent = data.error;
                    document.getElementById('loginError').style.display = 'block';
                }
            })
            .catch(error => {
                document.getElementById('loginError').textContent = 'Fout bij inloggen';
                document.getElementById('loginError').style.display = 'block';
            });
        });

        // Registration functionality
        document.getElementById('registerBtn').addEventListener('click', function() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            
            fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessMessage('Registratie succesvol! Je kunt nu inloggen.');
                    setTimeout(() => {
                        document.getElementById('registerForm').style.display = 'none';
                        document.getElementById('loginForm').style.display = 'block';
                    }, 2000);
                } else {
                    document.getElementById('registerError').textContent = data.error;
                    document.getElementById('registerError').style.display = 'block';
                }
            })
            .catch(error => {
                document.getElementById('registerError').textContent = 'Fout bij registreren';
                document.getElementById('registerError').style.display = 'block';
            });
        });

        // Change Password functionality
        document.getElementById('changePasswordBtn').addEventListener('click', function() {
            const username = document.getElementById('changeUsername').value;
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            
            // Basic validation
            if (!username || !oldPassword || !newPassword) {
                document.getElementById('changePasswordError').textContent = 'Vul alle velden in';
                document.getElementById('changePasswordError').style.display = 'block';
                return;
            }
            
            if (newPassword.length < 6) {
                document.getElementById('changePasswordError').textContent = 'Nieuw wachtwoord moet minimaal 6 tekens lang zijn';
                document.getElementById('changePasswordError').style.display = 'block';
                return;
            }
            
            fetch('/change_password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, oldPassword, newPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessMessage('Wachtwoord succesvol gewijzigd! Je kunt nu inloggen met je nieuwe wachtwoord.');
                    setTimeout(() => {
                        document.getElementById('changePasswordForm').style.display = 'none';
                        document.getElementById('loginForm').style.display = 'block';
                        // Clear the form
                        document.getElementById('changeUsername').value = '';
                        document.getElementById('oldPassword').value = '';
                        document.getElementById('newPassword').value = '';
                    }, 2000);
                } else {
                    document.getElementById('changePasswordError').textContent = data.error;
                    document.getElementById('changePasswordError').style.display = 'block';
                }
            })
            .catch(error => {
                document.getElementById('changePasswordError').textContent = 'Fout bij wijzigen wachtwoord';
                document.getElementById('changePasswordError').style.display = 'block';
            });
        });
        
        function showRegistrationDisabledMessage() {
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;';
            
            const card = document.createElement('div');
            card.style.cssText = 'background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); min-width: 400px; animation: bounceIn 0.6s ease-out;';
            
            card.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: white;">
                    <div style="margin-bottom: 1.5rem;">
                        <i class="fas fa-user-slash" style="font-size: 3rem; opacity: 0.9;"></i>
                    </div>
                    <h4 style="font-weight: bold; margin-bottom: 1.5rem;">Registratie Uitgeschakeld</h4>
                    <p style="margin-bottom: 2rem;">Nieuwe registraties zijn momenteel niet toegestaan. Neem contact op met de beheerder voor meer informatie.</p>
                    <button class="btn btn-light btn-lg" id="closeRegistrationMessage">
                        <i class="fas fa-times me-2"></i>Sluiten
                    </button>
                </div>
            `;
            
            overlay.appendChild(card);
            document.body.appendChild(overlay);
            
            // Add click event to close button
            document.getElementById('closeRegistrationMessage').addEventListener('click', function() {
                overlay.remove();
            });
        }
        
        function showSuccessMessage(message) {
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;';
            
            const card = document.createElement('div');
            card.style.cssText = 'background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); min-width: 400px; animation: bounceIn 0.6s ease-out;';
            
            card.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: white;">
                    <div style="margin-bottom: 1.5rem;">
                        <i class="fas fa-check-circle" style="font-size: 3rem; opacity: 0.9;"></i>
                    </div>
                    <h4 style="font-weight: bold; margin-bottom: 1.5rem;">Succes!</h4>
                    <p style="margin-bottom: 0;">${message}</p>
                </div>
            `;
            
            overlay.appendChild(card);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.remove();
                }
            }, 2000);
        }
    </script>
    
    <style>
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05);
            }
            70% {
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
    </style>
</body>
</html>